<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Mechatronics Portfolio: Lab 4: Closed-Loop Speed Control</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="cpslo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Mechatronics Portfolio
   </div>
   <div id="projectbrief">Nicholas De Simone&#39;s Mechatronics Project Portfolio</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Lab 4: Closed-Loop Speed Control </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#sec_intro4">Introduction</a></li>
<li class="level1"><a href="#sec_res4">Results</a></li>
<li class="level1"><a href="#sec_files4">Project Files</a><ul><li class="level2"><a href="#sub_main4">Main File</a></li>
<li class="level2"><a href="#sub_utask4">User Task</a></li>
<li class="level2"><a href="#sub_ctask4">Controller Task</a></li>
<li class="level2"><a href="#sub_mtask4">Motor Task</a></li>
<li class="level2"><a href="#sub_stask4">Safety Task</a></li>
<li class="level2"><a href="#sub_etask4">Encoder Task</a></li>
<li class="level2"><a href="#sub_clc4">Closed-Loop Control Driver</a></li>
<li class="level2"><a href="#sub_mot4">Motor Driver</a></li>
<li class="level2"><a href="#sub_drv4">DRY8847 Driver</a></li>
<li class="level2"><a href="#sub_enc4">Encoder Driver</a></li>
<li class="level2"><a href="#sub_sha4">Shares Class</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>Closed-loop speed control of DC motors.</p>
<h1><a class="anchor" id="sec_intro4"></a>
Introduction</h1>
<p>Lab 4 introduces task and driver files to accomodate proportional and integral speed control of DC motors. The closed-loop controller reads from the motors' quadrature encoders for error feedback, as well as accepts user-input controller gains Kp and Ki to compute motor actuation signals based on the error in motor velocity versus the user- input velocity setpoint. Please see <a class="el" href="lab4page_8py.html#sec_files4">Project Files</a> for descriptions of our project files.</p>
<p>Note the following block diagram for observation of our closed-loop controller: </p><div class="image">
<img src="block_diagram.png" alt="" width="700px"/>
</div>
<h1><a class="anchor" id="sec_res4"></a>
Results</h1>
<p>The Lab 4 firmware is able to conduct user-defined velocity step response tests on the DC motor, which allow for observation of the controller's performance in relation to the user defined controller gains and velocity setpoint. Please see <b>Figures 1-3</b> for three step response tests, each conducted with a velocity setpoint of 100 [rad/s] and variable Kp/Ki controller gains. Note subsequent evaluations of their controller performance, including steady-state error and settling time.</p>
<center> <div class="image">
<img src="Lab4Data1.png" alt="" width="500px"/>
</div>
 <b>Figure 1:</b> The first step-response test was conducted with a Kp of 0.25 [%*s/rad] and Ki of 20 [Hz]. Note the acceptable steady-state error of -0.80 [rad/s] and lack of overshoot, but the relatively slow settling time of 0.404 [sec].</center><center> <div class="image">
<img src="Lab4Data2.png" alt="" width="500px"/>
</div>
 <b>Figure 2:</b> The second step-response test was conducted with a Kp of 0.50 [%*s/rad] and Ki of 20 [Hz]. Note the steady-state error and settling time have both decreased, as compared to <b>Figure 1</b>, to -0.59 [rad/s] and 0.26 [sec], respectively. However, the increased Kp value produced undesirable overshoot of both the motor's angular velocity and actuation signal, which should be mitigated through further tuning of the controller gains. <br  />
</center><center> <div class="image">
<img src="Lab4Data3.png" alt="" width="500px"/>
</div>
 <b>Figure 3:</b> The third step-response test was conducted with a Kp of 0.25 [%*s/rad] and Ki of 50 [Hz]. Note the settling time has decreased further to 0.129 [sec], although the steady-state error returns to around 0.78 [rad/s]. However, oscillation is minimized, which we have chosen to optimize over settling time. </center><h1><a class="anchor" id="sec_files4"></a>
Project Files</h1>
<h2><a class="anchor" id="sub_main4"></a>
Main File</h2>
<p>The main file instantiates our task- and class-files as objects to be run asynchronously. Note the task diagram below for information regarding file communication and run frequency. See <a class="el" href="main_8py.html">main.py</a> for more information. </p><div class="image">
<img src="taskDiagram4.png" alt="" width="600px"/>
</div>
<h2><a class="anchor" id="sub_utask4"></a>
User Task</h2>
<p>The user interface is written as a generator function that prints to a terminal emulator. It is able to read a user's keyboard presses as encoder, motor driver, and controller commands, such as printing the encoder's position in ticks or accepting user-input controller gain and velocity setpoint values, over the USB virtual comm port. See <a class="el" href="_u_task_8py.html">UTask.py</a> for more information and the figure below for the User Task's state transition diagram. </p><div class="image">
<img src="UTaskSTD4.png" alt="" width="600px"/>
</div>
<h2><a class="anchor" id="sub_ctask4"></a>
Controller Task</h2>
<p>The controller task communicates controller gain values, Kp and Ki, and motor velocity setpoints to our closed-loop driver, <a class="el" href="closedloop_8py.html">closedloop.py</a>. This task is also responsible for sending duty cycles to the motor task, which enables motor actuation according to the actuation signal computed in the closed-loop driver. See <a class="el" href="_c_task_8py.html">CTask.py</a> for more information and the figure below for the Controller Task's state transition diagram. </p><div class="image">
<img src="CTAskSTD4.png" alt="" width="500px"/>
</div>
<h2><a class="anchor" id="sub_mtask4"></a>
Motor Task</h2>
<p>The motor task sends duty cycles, which are determined as the actuation signal of the closed-loop controller, to their respective motors, either Motor 1 or Motor 2. See <a class="el" href="_m_task_8py.html">MTask.py</a> for more information and the figure below for the Motor Task's state transition diagram. </p><div class="image">
<img src="MTaskSTD3.png" alt="" width="500px"/>
</div>
<h2><a class="anchor" id="sub_stask4"></a>
Safety Task</h2>
<p>The safety task enables and disables the motors according to the user's keyboard presses, or at the occurence of faults triggered by the motor driver chip, the DRV8847. See <a class="el" href="_s_task_8py.html">STask.py</a> for more information and the figure below for the Safety Task's state transition diagram. </p><div class="image">
<img src="STaskSTD3.png" alt="" width="500px"/>
</div>
<h2><a class="anchor" id="sub_etask4"></a>
Encoder Task</h2>
<p>The encoder task uses a generator function to update a shared tuple, encData, that stores time [ms], position [ticks], and position changes [ticks/sec]. See <a class="el" href="_e_task_8py.html">ETask.py</a> for more information and the figure below for the Encoder Task's state transition diagram. </p><div class="image">
<img src="ETaskSTD3.png" alt="" width="500px"/>
</div>
<h2><a class="anchor" id="sub_clc4"></a>
Closed-Loop Control Driver</h2>
<p>The closed-loop driver is a class file that computes actuation signals according to user-defined controller gains, Kp and Ki, and desired motor velocity setpoints. The controller is able to perform proportional and/or integral closed-loop control. See <a class="el" href="closedloop_8py.html">closedloop.py</a> for more information.</p>
<h2><a class="anchor" id="sub_mot4"></a>
Motor Driver</h2>
<p>The motor driver is a class file that instantiates timer and timer channel objects for the designated motor's PWM channels, which are configured as inverted PWM channels. The driver also has a method to set motor duty cycles as a pulse width percent, whose value is determined by the user's entered duty cycle. See <a class="el" href="motor_8py.html">motor.py</a> for more information.</p>
<h2><a class="anchor" id="sub_drv4"></a>
DRY8847 Driver</h2>
<p>The DRV8847 class file handles control of our physical motor driver, the DRV8847. Its associated methods include enabling and disabling the driver's enable pin, clearing motor faults triggered by the driver's fault pin, or specifying motor pin, timer, and timer channel values, all of which are called either in <a class="el" href="main_8py.html">main.py</a> or in the safety task, <a class="el" href="_s_task_8py.html">STask.py</a>. See <a class="el" href="_d_r_v8847_8py.html">DRV8847.py</a> for more information.</p>
<h2><a class="anchor" id="sub_enc4"></a>
Encoder Driver</h2>
<p>The encoder driver is a class file that instantiates timer and timer channel objects and has various methods for reading data from the encoder. See <a class="el" href="encoder_8py.html">encoder.py</a> for more information.</p>
<h2><a class="anchor" id="sub_sha4"></a>
Shares Class</h2>
<p>The shares class file allows variables to be created, read from, and written to multiple files. See <a class="el" href="shares_8py.html">shares.py</a> for more information. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.0
</small></address>
</body>
</html>
