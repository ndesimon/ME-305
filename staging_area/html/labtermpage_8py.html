<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Mechatronics Portfolio: Term Project: Ball-Balancing Platform</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="cpslo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Mechatronics Portfolio
   </div>
   <div id="projectbrief">Nicholas De Simone&#39;s Mechatronics Project Portfolio</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Term Project: Ball-Balancing Platform </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#sec_introT">Introduction</a></li>
<li class="level1"><a href="#sec_resT">Results</a></li>
<li class="level1"><a href="#sec_datT">Data Collection</a></li>
<li class="level1"><a href="#sec_filesT">Project Files</a><ul><li class="level2"><a href="#sub_mainT">Main File</a></li>
<li class="level2"><a href="#sub_utaskT">User Task</a></li>
<li class="level2"><a href="#sub_ttaskT">Touch Panel Task</a></li>
<li class="level2"><a href="#sub_imutaskT">IMU Task</a></li>
<li class="level2"><a href="#sub_ctaskT">Controller Task</a></li>
<li class="level2"><a href="#sub_mtaskT">Motor Task</a></li>
<li class="level2"><a href="#sub_touT">Touch Panel Driver</a></li>
<li class="level2"><a href="#sub_imuT">BNO055 Driver</a></li>
<li class="level2"><a href="#sub_clcT">Closed-Loop Control Driver</a></li>
<li class="level2"><a href="#sub_motT">Motor Driver</a></li>
<li class="level2"><a href="#sub_shaT">Shares Class</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>Balance ball on top of rotating resistive touch panel.</p>
<h1><a class="anchor" id="sec_introT"></a>
Introduction</h1>
<p>For our ME 305 Term Project, our team attempted to balance a steel ball on top of a rotating platform. This project involved reading from a resistive touch panel (upon which the ball was placed) and an IMU device in order to perform cascaded closed-loop control on two DC motors. Please note that this term project builds on <a class="el" href="lab3page_8py.html">Lab 3: DC Motor Control</a>, <a class="el" href="lab4page_8py.html">Lab 4: Closed-Loop Speed Control</a>, and <a class="el" href="lab5page_8py.html">Lab 5: I2C and Inertial Measurement Unit</a>, so it may be advantageous for the reader to consider the documentation for each of those labs as well.</p>
<p>The resistive touch panel was the only new hardware component to this lab, and it was used to detect the ball's x- and y-locations and velocities atop the platform. This data was delivered as an outer-loop feedback signal to the firmware's cascaded controller, which also involves inner-loop control according to data from the IMU device. See the block diagram depicted below for observation of our closed-loop controller. And please see <a class="el" href="labtermpage_8py.html#sec_filesT">Project Files</a> for descriptions of our project files. </p><div class="image">
<img src="term_block_diagram.png" alt="" width="600px"/>
</div>
<h1><a class="anchor" id="sec_resT"></a>
Results</h1>
<p>Ultimately, our team was unsuccessful in balancing the ball for any extended period of time. However, we have reached successful implementation of all components of the platform control, save for correct Kp, Ki, and Kd gain values. Features include, but are certainly not limited to, reading from the touch panel and IMU devices, closed-loop motor control to manipulate the platform's angle, thorough user interface and data collection features, and, with further tuning of the outer- and inner-loop controller gains, we are confident that our system would be able to successfully balance the ball. Please see the following video for a demonstration of our term project: <br  />
 </p><center>  
    <iframe width="560" height="315" 
    src="https://www.youtube.com/embed/GsEgwm0p4Bg" 
    title="YouTube video player" frameborder="0" allow="accelerometer; 
    autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
    allowfullscreen></iframe>
     </center><p> <br  />
 <br  />
</p>
<h1><a class="anchor" id="sec_datT"></a>
Data Collection</h1>
<p>A user of our Term Project firmware is able to collect up to 15 seconds worth of data from nine categories of the associated hardware, where this data is written to a CSV file and may then be plotted in various configurations. The data set includes time in [sec], the ball's position and velocity, in both the x- and y-directions, and the rotating platform's angular position and velocity, in both the x- and y-directions. Please see <b>Figures 1-9</b> for observation of this data.</p>
<center> <div class="image">
<img src="YvX.png" alt="" width="500px"/>
</div>
 <b>Figure 1:</b> Ball Position on Platform over Time. The ball's position along the x- and y-axes (defined here as the horizontal and vertical positions, respectively) of the platform are plotted against one another to provide a visual of the ball's path of travel over time.</center><center> <div class="image">
<img src="XvT.png" alt="" width="500px"/>
</div>
 <b>Figure 2:</b> Horizontal Ball Position over Time. The ball's position, in [mm], along the x-axis of the platform plotted over time in [sec].</center><center> <div class="image">
<img src="YvT.png" alt="" width="500px"/>
</div>
 <b>Figure 3:</b> Vertical Ball Position over Time. The ball's position, in [mm], along the y-axis of the platform plotted over time in [sec].</center><center> <div class="image">
<img src="VXvT.png" alt="" width="500px"/>
</div>
 <b>Figure 4:</b> Horizontal Ball Velocity over Time. The ball's velocity, in [mm/s], along the x-axis of the platform plotted over time in [sec].</center><center> <div class="image">
<img src="VYvT.png" alt="" width="500px"/>
</div>
 <b>Figure 5:</b> Vertical Ball Velocity over Time. The ball's velocity, in [mm/s], along the y-axis of the platform plotted over time in [sec].</center><center> <div class="image">
<img src="THXvT.png" alt="" width="500px"/>
</div>
 <b>Figure 6:</b> Platform Pitch over Time. The platform's angular position, in [deg], about the x-axis of the platform plotted over time in [sec].</center><center> <div class="image">
<img src="THYvT.png" alt="" width="500px"/>
</div>
 <b>Figure 7:</b> Platform Roll over Time. The platform's angular position, in [deg], about the y-axis of the platform plotted over time in [sec].</center><center> <div class="image">
<img src="OMXvT.png" alt="" width="500px"/>
</div>
 <b>Figure 8:</b> Platform Pitch Velocity over Time. The platform's angular velocity, in [deg/s], about the x-axis of the platform plotted over time in [sec].</center><center> <div class="image">
<img src="OMYvT.png" alt="" width="500px"/>
</div>
 <b>Figure 9:</b> Platform Roll Velocity over Time. The platform's angular velocity, in [deg/s], about the y-axis of the platform plotted over time in [sec]. <br  />
 </center><h1><a class="anchor" id="sec_filesT"></a>
Project Files</h1>
<h2><a class="anchor" id="sub_mainT"></a>
Main File</h2>
<p>The main file instantiates our task- and class-files as objects to be run asynchronously. Note the task diagram below for information regarding file communication and run frequency. See <a class="el" href="main_8py.html">main.py</a> for more information. </p><div class="image">
<img src="term_task_diagram.png" alt="" width="500px"/>
</div>
<h2><a class="anchor" id="sub_utaskT"></a>
User Task</h2>
<p>The user interface is written as a generator function that prints to a terminal emulator. It is able to read a user's keyboard presses as controller and IMU commands, such as printing the IMU's current Euler angles and angular velocities or accepting user-input controller gain values, over the USB virtual comm port. See <a class="el" href="_u_task5_8py.html">UTask5.py</a> for more information, and the figure below for the User Task's state transition diagram. </p><div class="image">
<img src="term_ui_task_std.png" alt="" width="600px"/>
</div>
<h2><a class="anchor" id="sub_ttaskT"></a>
Touch Panel Task</h2>
<p>The touch panel task calls methods of the panel's driver class, <a class="el" href="touchpad_8py.html">touchpad.py</a>, to read the ball's position and velocity data atop the platform, as well as to prompt user calibration when necessary. Note that the task performs alpha-beta filtering of the ADC readings pulled from the panel driver and is also able to execute shift, scale, and offset corrections on said panel data. See <a class="el" href="_t_task_8py.html">TTask.py</a> for more information and the figure below for the Touch Panel Task's state transition diagram. </p><div class="image">
<img src="ttask_std.png" alt="" width="500px"/>
</div>
<h2><a class="anchor" id="sub_imutaskT"></a>
IMU Task</h2>
<p>The IMU task calls methods of the BNO055 driver class, <a class="el" href="_b_n_o055_8py.html">BNO055.py</a>, to read IMU data and prompt user calibration when necessary. See <a class="el" href="_m_task5_8py.html">MTask5.py</a> for more information and the figure below for the IMU Task's state transition diagram. </p><div class="image">
<img src="imutask_std.png" alt="" width="500px"/>
</div>
<h2><a class="anchor" id="sub_ctaskT"></a>
Controller Task</h2>
<p>The controller task communicates controller gain values Kp, Kd, and Ki, angular setpoints, and Euler angle/angular velocity data (read from the IMU device) to our closed-loop driver, <a class="el" href="closedloop5_8py.html">closedloop5.py</a>. This task is also responsible for sending duty cycles to the motor task, which enables motor actuation according to the actuation signal computed in the closed-loop driver. Note that the controller task is able to control the outer- and inner-loop for our cascaded controller. See <a class="el" href="_c_task5_8py.html">CTask5.py</a> for more information and the figure below for the Controller Task's state transition diagram. </p><div class="image">
<img src="term_ctask_std.png" alt="" width="500px"/>
</div>
<h2><a class="anchor" id="sub_mtaskT"></a>
Motor Task</h2>
<p>The motor task sends duty cycles, which are determined as the actuation signal of the closed-loop controller, to their respective motors, either Motor 1 or Motor 2. See <a class="el" href="_m_task5_8py.html">MTask5.py</a> for more information and the figure below for the Motor Task's state transition diagram. </p><div class="image">
<img src="MTaskSTD3.png" alt="" width="500px"/>
</div>
<h2><a class="anchor" id="sub_touT"></a>
Touch Panel Driver</h2>
<p>This driver class handles ADC readings of the resistive touch panel device, which are associated with the ball's position and velocity. Associated methods include (1) configuring the panel's four pins as outputs, floats, or ADCs to scan the x-y-z axes of the panel and (2) setting values for the scale, shift, and offset calibration coefficients to convert our ADC readings into acceptable distance ([mm]) readings. See <a class="el" href="touchpad_8py.html">touchpad.py</a> for more information.</p>
<h2><a class="anchor" id="sub_imuT"></a>
BNO055 Driver</h2>
<p>This driver class handles I2C communication with the BNO055 IMU device. Associated methods include reading Euler angle and angular velocity data from the BNO, as well as reading/writing calibration coefficients according to the device's current calibration status. See <a class="el" href="_b_n_o055_8py.html">BNO055.py</a> for more information.</p>
<h2><a class="anchor" id="sub_clcT"></a>
Closed-Loop Control Driver</h2>
<p>The closed-loop driver is a class file that computes actuation signals according to user-defined controller gains Kp, Ki, and Kd, desired setpoint, and, for use with the IMU or touch panel devices, the IMU's Euler angle and angular velocity data or the ball's position and velocity, respectively. For our cascaded controller, the actuation signal computed by the outer-loop, which pulls its reference and feedback signals from the touch panel data, is sent as the reference signal for the inner-loop, which pulls its reference and feedback signals from the IMU data. The controller is able to perform proportional, integral, and/or derivative control. See <a class="el" href="closedloop5_8py.html">closedloop5.py</a> for more information.</p>
<h2><a class="anchor" id="sub_motT"></a>
Motor Driver</h2>
<p>The motor driver is a class file that instantiates pin, timer, and timer channel objects for the designated motor's PWM channels, which are configured as inverted PWM channels. The driver also has a method to set motor duty cycles as a pulse width percent, whose value is passed in as the closed-loop controller's actuation signal. See <a class="el" href="motor5_8py.html">motor5.py</a> for more information.</p>
<h2><a class="anchor" id="sub_shaT"></a>
Shares Class</h2>
<p>The shares class file allows variables to be created, read from, and written to multiple files. See <a class="el" href="shares_8py.html">shares.py</a> for more information. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.0
</small></address>
</body>
</html>
