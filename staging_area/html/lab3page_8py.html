<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Mechatronics Portfolio: Lab 3: DC Motor Control</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="cpslo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Mechatronics Portfolio
   </div>
   <div id="projectbrief">Nicholas De Simone&#39;s Mechatronics Project Portfolio</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Lab 3: DC Motor Control </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#sec_intro3">Introduction</a></li>
<li class="level1"><a href="#sec_res3">Results</a></li>
<li class="level1"><a href="#sec_files3">Project Files</a><ul><li class="level2"><a href="#sub_main3">Main File</a></li>
<li class="level2"><a href="#sub_utask3">User Task</a></li>
<li class="level2"><a href="#sub_mtask3">Motor Task</a></li>
<li class="level2"><a href="#sub_stask3">Safety Task</a></li>
<li class="level2"><a href="#sub_etask3">Encoder Task</a></li>
<li class="level2"><a href="#sub_mot3">Motor Driver</a></li>
<li class="level2"><a href="#sub_drv3">DRY8847 Driver</a></li>
<li class="level2"><a href="#sub_enc3">Encoder Driver</a></li>
<li class="level2"><a href="#sub_sha3">Shares Class</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>DC motor driving using PWM.</p>
<h1><a class="anchor" id="sec_intro3"></a>
Introduction</h1>
<p>Lab 3 achieves independent control of two DC motors by applying PWM signals to their associated timer channels. The motors are enabled via the DRV8847 motor driver from Texas Instruments, which is also able to disable the motors by triggering fault conditions. Thus, Lab 3 implements task and driver files that are able to handle the motor and each of the two DC motors independently. A user interface task is also included to interpret user keyboard presses as motor and/or motor driver commands, such as setting the motor duty cycles (in pulse width percent), enabling and disabling the motor driver, and clearing motor fault conditions. Please see <a class="el" href="lab3page_8py.html#sec_files3">Project Files</a> for descriptions of our project files.</p>
<h1><a class="anchor" id="sec_res3"></a>
Results</h1>
<p>The Lab 3 firmware offers two opportunities for data collection; the user may choose (1) to record encoder position over time or (2) to compute the average velocity, in [rad/s], of Motor 1 according to input duty cycles in [% PWM]. See <b>Figures 1-2</b> for observation of experimental results for each of these cases.</p>
<center> <div class="image">
<img src="Lab3Data1.png" alt="" width="500px"/>
</div>
 <b>Figure 1:</b> Encoder position, converted to [rad] from encoder ticks, over time in [sec].</center><center> <div class="image">
<img src="Lab3Data2.png" alt="" width="500px"/>
</div>
 <b>Figure 2:</b> Average motor speeds, in [rad/s], for input duty cycles ranging from -100 to 100 [% PWM], in 10 [% PWM] increments. Note the slight non-linear relationship between the actual motor speed and duty cycle (especially between -20 to 20 [% PWM]), as compared to the theoretically linear trend between the two. This error is indicative of physical nonlinearities in the motors, like voltage losses or motor stiction. </center><h1><a class="anchor" id="sec_files3"></a>
Project Files</h1>
<h2><a class="anchor" id="sub_main3"></a>
Main File</h2>
<p>The main file instantiates our task- and class-files as objects to be run asynchronously. Note the task diagram below for information regarding file communication and run frequency. See <a class="el" href="main_8py.html">main.py</a> for more information. </p><div class="image">
<img src="taskDiagram3.png" alt="" width="600px"/>
</div>
<h2><a class="anchor" id="sub_utask3"></a>
User Task</h2>
<p>The user interface is written as a generator function that prints to a terminal emulator. It is able to read a user's keyboard presses as encoder and motor commands, such as collecting the encoder's position over time or accepting user-input motor PWM duty cycles, over the USB virtual comm port. See <a class="el" href="_u_task_8py.html">UTask.py</a> for more information and the figure below for the User Task's state transition diagram. </p><div class="image">
<img src="UTaskSTD3.png" alt="" width="600px"/>
</div>
<h2><a class="anchor" id="sub_mtask3"></a>
Motor Task</h2>
<p>The motor task sends user-determined duty cycles to their respective motors, either Motor 1 or Motor 2. See <a class="el" href="_m_task_8py.html">MTask.py</a> for more information and the figure below for the Motor Task's state transition diagram. </p><div class="image">
<img src="MTaskSTD3.png" alt="" width="500px"/>
</div>
<h2><a class="anchor" id="sub_stask3"></a>
Safety Task</h2>
<p>The safety task enables and disables the motors according to the user's keyboard presses, or at the occurence of faults, which are triggered by the motor driver, the DRV8847. See <a class="el" href="_s_task_8py.html">STask.py</a> for more information and the figure below for the Safety Task's state transition diagram. </p><div class="image">
<img src="STaskSTD3.png" alt="" width="500px"/>
</div>
<h2><a class="anchor" id="sub_etask3"></a>
Encoder Task</h2>
<p>The encoder task uses a generator function to update a shared tuple, encData, that stores time [ms], position [ticks], and position changes [ticks/sec]. See <a class="el" href="_e_task_8py.html">ETask.py</a> for more information and the figure below for the Encoder Task's state transition diagram. </p><div class="image">
<img src="ETaskSTD3.png" alt="" width="500px"/>
</div>
<h2><a class="anchor" id="sub_mot3"></a>
Motor Driver</h2>
<p>The motor driver is a class file that instantiates timer and timer channel objects for the designated motor's PWM channels, which are configured as inverted PWM channels. The driver also has a method to set motor duty cycles as a pulse width percent, whose value is determined by the user's entered duty cycle. See <a class="el" href="motor_8py.html">motor.py</a> for more information.</p>
<h2><a class="anchor" id="sub_drv3"></a>
DRY8847 Driver</h2>
<p>The DRV8847 class file handles control of our physical motor driver, the DRV8847. Its associated methods include enabling and disabling the driver's enable pin, clearing motor faults triggered by the driver's fault pin, or specifying motor pin, timer, and timer channel values, all of which are called either in <a class="el" href="main_8py.html">main.py</a> or in the safety task, <a class="el" href="_s_task_8py.html">STask.py</a>. See <a class="el" href="_d_r_v8847_8py.html">DRV8847.py</a> for more information.</p>
<h2><a class="anchor" id="sub_enc3"></a>
Encoder Driver</h2>
<p>The encoder driver is a class file that instantiates timer and timer channel objects and has various methods for reading data from the encoder. See <a class="el" href="encoder_8py.html">encoder.py</a> for more information.</p>
<h2><a class="anchor" id="sub_sha3"></a>
Shares Class</h2>
<p>The shares class file allows variables to be created, read from, and written to multiple files. See <a class="el" href="shares_8py.html">shares.py</a> for more information. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.0
</small></address>
</body>
</html>
