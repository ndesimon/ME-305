Balance a platform using IMU data and closed-\/loop motor control.\hypertarget{lab5page_8py_sec_intro5}{}\doxysection{Introduction}\label{lab5page_8py_sec_intro5}
Lab 5 incorporates new task and driver files that use the I2C communication protocol to read angular position and velocity data from an inertial measurement unit, the Bosch BNO055, that is attached to our platform. This data is implemented as feedback in the closed-\/loop controller of Lab 4, with the goal of stabilizing the platform.

Platform stability is achieved when the BNO055 senses zero degrees for the \char`\"{}pitch\char`\"{} and \char`\"{}roll\char`\"{} Euler angles, which correspond to our platform\textquotesingle{}s x-\/ and y-\/axes, respectively. Note that, in order to read acceptable values from the IMU, a calibration procedure is necessary. This procedure is prompted in the User Interface when a \char`\"{}.\+txt\char`\"{} file is not available on the host Nucleo MCU. Upon completion of the calibration procedure, the calibration coefficients, which are read from their corresponding register address on the BNO, are written to a \char`\"{}.\+txt\char`\"{} file and saved on the MCU for subsequent runs. ~\newline
 Please see \mbox{\hyperlink{lab5page_8py_sec_files5}{Project Files}} for descriptions of our project files.\hypertarget{lab5page_8py_sec_files5}{}\doxysection{Project Files}\label{lab5page_8py_sec_files5}
\hypertarget{lab5page_8py_sub_main5}{}\doxysubsection{Main File}\label{lab5page_8py_sub_main5}
The main file instantiates our task-\/ and class-\/files as objects to be run asynchronously. Note the task diagram below for information regarding file communication and run frequency. See \mbox{\hyperlink{main_8py}{main.\+py}} for more information. \hypertarget{lab5page_8py_sub_utask5}{}\doxysubsection{User Task}\label{lab5page_8py_sub_utask5}
The user interface is written as a generator function that prints to a terminal emulator. It is able to read a user\textquotesingle{}s keyboard presses as controller and IMU commands, such as printing the IMU\textquotesingle{}s current Euler angles and angular velocities or accepting user-\/input controller gain values, over the USB virtual comm port. See \mbox{\hyperlink{_u_task5_8py}{UTask5.\+py}} for more information, and the figure below for the User Task\textquotesingle{}s state transition diagram. \hypertarget{lab5page_8py_sub_imutask5}{}\doxysubsection{IMU Task}\label{lab5page_8py_sub_imutask5}
The IMU task calls methods of the BNO055 driver class, \mbox{\hyperlink{_b_n_o055_8py}{BNO055.\+py}}, to read IMU data and prompt user calibration when necessary. See \mbox{\hyperlink{_i_m_u_task_8py}{IMUTask.\+py}} for more information and the figure below for the IMU Task\textquotesingle{}s state transition diagram. \hypertarget{lab5page_8py_sub_ctask5}{}\doxysubsection{Controller Task}\label{lab5page_8py_sub_ctask5}
The controller task communicates controller gain values Kp, Kd, and Ki, angular setpoints, and Euler angle/angular velocity data (read from the IMU device) to our closed-\/loop driver, \mbox{\hyperlink{closedloop5_8py}{closedloop5.\+py}}. This task is also responsible for sending duty cycles to the motor task, which enables motor actuation according to the actuation signal computed in the closed-\/loop driver. ~\newline
 See \mbox{\hyperlink{_c_task5_8py}{CTask5.\+py}} for more information and the figure below for the Controller Task\textquotesingle{}s state transition diagram. \hypertarget{lab5page_8py_sub_mtask5}{}\doxysubsection{Motor Task}\label{lab5page_8py_sub_mtask5}
The motor task sends duty cycles, which are determined as the actuation signal of the closed-\/loop controller, to their respective motors, either Motor 1 or Motor 2. See \mbox{\hyperlink{_m_task5_8py}{MTask5.\+py}} for more information and the figure below for the Motor Task\textquotesingle{}s state transition diagram. \hypertarget{lab5page_8py_sub_imu5}{}\doxysubsection{BNO055 Driver}\label{lab5page_8py_sub_imu5}
This driver class handles I2C communication with the BNO055 IMU device. Associated methods include reading Euler angle and angular velocity data from the BNO, as well as reading/writing calibration coefficients according to the device\textquotesingle{}s current calibration status. See \mbox{\hyperlink{_b_n_o055_8py}{BNO055.\+py}} for more information.\hypertarget{lab5page_8py_sub_clc5}{}\doxysubsection{Closed-\/\+Loop Control Driver}\label{lab5page_8py_sub_clc5}
The closed-\/loop driver is a class file that computes actuation signals according to user-\/defined controller gains Kp, Ki, and Kd, desired setpoint, and, for use with the IMU device, the IMU\textquotesingle{}s Euler angle and angular velocity data. For the self-\/balancing platform, the angular setpoint defaults to a 0 degree reference angle, such that the controller attempts to reach a level position. The controller is able to perform proportional, integral, and/or derivative control. See \mbox{\hyperlink{closedloop5_8py}{closedloop5.\+py}} for more information.\hypertarget{lab5page_8py_sub_mot5}{}\doxysubsection{Motor Driver}\label{lab5page_8py_sub_mot5}
The motor driver is a class file that instantiates pin, timer, and timer channel objects for the designated motor\textquotesingle{}s PWM channels, which are configured as inverted PWM channels. The driver also has a method to set motor duty cycles as a pulse width percent, whose value is passed in as the closed-\/loop controller\textquotesingle{}s actuation signal. See \mbox{\hyperlink{motor5_8py}{motor5.\+py}} for more information.\hypertarget{lab5page_8py_sub_sha5}{}\doxysubsection{Shares Class}\label{lab5page_8py_sub_sha5}
The shares class file allows variables to be created, read from, and written to multiple files. See \mbox{\hyperlink{shares_8py}{shares.\+py}} for more information. 