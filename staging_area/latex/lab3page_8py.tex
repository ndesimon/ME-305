DC motor driving using PWM.\hypertarget{lab3page_8py_sec_intro3}{}\doxysection{Introduction}\label{lab3page_8py_sec_intro3}
Lab 3 achieves independent control of two DC motors by applying PWM signals to their associated timer channels. The motors are enabled via the DRV8847 motor driver from Texas Instruments, which is also able to disable the motors by triggering fault conditions. Thus, Lab 3 implements task and driver files that are able to handle the motor and each of the two DC motors independently. A user interface task is also included to interpret user keyboard presses as motor and/or motor driver commands, such as setting the motor duty cycles (in pulse width percent), enabling and disabling the motor driver, and clearing motor fault conditions. Please see \mbox{\hyperlink{lab3page_8py_sec_files3}{Project Files}} for descriptions of our project files.\hypertarget{lab3page_8py_sec_res3}{}\doxysection{Results}\label{lab3page_8py_sec_res3}
The Lab 3 firmware offers two opportunities for data collection; the user may choose (1) to record encoder position over time or (2) to compute the average velocity, in \mbox{[}rad/s\mbox{]}, of Motor 1 according to input duty cycles in \mbox{[}\% PWM\mbox{]}. See {\bfseries{Figures 1-\/2}} for observation of experimental results for each of these cases.

\begin{center}  {\bfseries{Figure 1\+:}} Encoder position, converted to \mbox{[}rad\mbox{]} from encoder ticks, over time in \mbox{[}sec\mbox{]}.\end{center} 

\begin{center}  {\bfseries{Figure 2\+:}} Average motor speeds, in \mbox{[}rad/s\mbox{]}, for input duty cycles ranging from -\/100 to 100 \mbox{[}\% PWM\mbox{]}, in 10 \mbox{[}\% PWM\mbox{]} increments. Note the slight non-\/linear relationship between the actual motor speed and duty cycle (especially between -\/20 to 20 \mbox{[}\% PWM\mbox{]}), as compared to the theoretically linear trend between the two. This error is indicative of physical nonlinearities in the motors, like voltage losses or motor stiction. \end{center} \hypertarget{lab3page_8py_sec_files3}{}\doxysection{Project Files}\label{lab3page_8py_sec_files3}
\hypertarget{lab3page_8py_sub_main3}{}\doxysubsection{Main File}\label{lab3page_8py_sub_main3}
The main file instantiates our task-\/ and class-\/files as objects to be run asynchronously. Note the task diagram below for information regarding file communication and run frequency. See \mbox{\hyperlink{main_8py}{main.\+py}} for more information. \hypertarget{lab3page_8py_sub_utask3}{}\doxysubsection{User Task}\label{lab3page_8py_sub_utask3}
The user interface is written as a generator function that prints to a terminal emulator. It is able to read a user\textquotesingle{}s keyboard presses as encoder and motor commands, such as collecting the encoder\textquotesingle{}s position over time or accepting user-\/input motor PWM duty cycles, over the USB virtual comm port. See \mbox{\hyperlink{_u_task_8py}{UTask.\+py}} for more information and the figure below for the User Task\textquotesingle{}s state transition diagram. \hypertarget{lab3page_8py_sub_mtask3}{}\doxysubsection{Motor Task}\label{lab3page_8py_sub_mtask3}
The motor task sends user-\/determined duty cycles to their respective motors, either Motor 1 or Motor 2. See \mbox{\hyperlink{_m_task_8py}{MTask.\+py}} for more information and the figure below for the Motor Task\textquotesingle{}s state transition diagram. \hypertarget{lab3page_8py_sub_stask3}{}\doxysubsection{Safety Task}\label{lab3page_8py_sub_stask3}
The safety task enables and disables the motors according to the user\textquotesingle{}s keyboard presses, or at the occurence of faults, which are triggered by the motor driver, the DRV8847. See \mbox{\hyperlink{_s_task_8py}{STask.\+py}} for more information and the figure below for the Safety Task\textquotesingle{}s state transition diagram. \hypertarget{lab3page_8py_sub_etask3}{}\doxysubsection{Encoder Task}\label{lab3page_8py_sub_etask3}
The encoder task uses a generator function to update a shared tuple, enc\+Data, that stores time \mbox{[}ms\mbox{]}, position \mbox{[}ticks\mbox{]}, and position changes \mbox{[}ticks/sec\mbox{]}. See \mbox{\hyperlink{_e_task_8py}{ETask.\+py}} for more information and the figure below for the Encoder Task\textquotesingle{}s state transition diagram. \hypertarget{lab3page_8py_sub_mot3}{}\doxysubsection{Motor Driver}\label{lab3page_8py_sub_mot3}
The motor driver is a class file that instantiates timer and timer channel objects for the designated motor\textquotesingle{}s PWM channels, which are configured as inverted PWM channels. The driver also has a method to set motor duty cycles as a pulse width percent, whose value is determined by the user\textquotesingle{}s entered duty cycle. See \mbox{\hyperlink{motor_8py}{motor.\+py}} for more information.\hypertarget{lab3page_8py_sub_drv3}{}\doxysubsection{DRY8847 Driver}\label{lab3page_8py_sub_drv3}
The DRV8847 class file handles control of our physical motor driver, the DRV8847. Its associated methods include enabling and disabling the driver\textquotesingle{}s enable pin, clearing motor faults triggered by the driver\textquotesingle{}s fault pin, or specifying motor pin, timer, and timer channel values, all of which are called either in \mbox{\hyperlink{main_8py}{main.\+py}} or in the safety task, \mbox{\hyperlink{_s_task_8py}{STask.\+py}}. See \mbox{\hyperlink{_d_r_v8847_8py}{DRV8847.\+py}} for more information.\hypertarget{lab3page_8py_sub_enc3}{}\doxysubsection{Encoder Driver}\label{lab3page_8py_sub_enc3}
The encoder driver is a class file that instantiates timer and timer channel objects and has various methods for reading data from the encoder. See \mbox{\hyperlink{encoder_8py}{encoder.\+py}} for more information.\hypertarget{lab3page_8py_sub_sha3}{}\doxysubsection{Shares Class}\label{lab3page_8py_sub_sha3}
The shares class file allows variables to be created, read from, and written to multiple files. See \mbox{\hyperlink{shares_8py}{shares.\+py}} for more information. 