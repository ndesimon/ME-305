<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Mechatronics Portfolio: Lab 5: I2C and Inertial Measurement Unit</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="cpslo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Mechatronics Portfolio
   </div>
   <div id="projectbrief">Nicholas De Simone&#39;s Mechatronics Project Portfolio</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Lab 5: I2C and Inertial Measurement Unit </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#sec_intro5">Introduction</a></li>
<li class="level1"><a href="#sec_files5">Project Files</a><ul><li class="level2"><a href="#sub_main5">Main File</a></li>
<li class="level2"><a href="#sub_utask5">User Task</a></li>
<li class="level2"><a href="#sub_imutask5">IMU Task</a></li>
<li class="level2"><a href="#sub_ctask5">Controller Task</a></li>
<li class="level2"><a href="#sub_mtask5">Motor Task</a></li>
<li class="level2"><a href="#sub_imu5">BNO055 Driver</a></li>
<li class="level2"><a href="#sub_clc5">Closed-Loop Control Driver</a></li>
<li class="level2"><a href="#sub_mot5">Motor Driver</a></li>
<li class="level2"><a href="#sub_sha5">Shares Class</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>Balance a platform using IMU data and closed-loop motor control.</p>
<h1><a class="anchor" id="sec_intro5"></a>
Introduction</h1>
<p>Lab 5 incorporates new task and driver files that use the I2C communication protocol to read angular position and velocity data from an inertial measurement unit, the Bosch BNO055, that is attached to our platform. This data is implemented as feedback in the closed-loop controller of Lab 4, with the goal of stabilizing the platform.</p>
<p>Platform stability is achieved when the BNO055 senses zero degrees for the "pitch" and "roll" Euler angles, which correspond to our platform's x- and y-axes, respectively. Note that, in order to read acceptable values from the IMU, a calibration procedure is necessary. This procedure is prompted in the User Interface when a ".txt" file is not available on the host Nucleo MCU. Upon completion of the calibration procedure, the calibration coefficients, which are read from their corresponding register address on the BNO, are written to a ".txt" file and saved on the MCU for subsequent runs. <br  />
 Please see <a class="el" href="lab5page_8py.html#sec_files5">Project Files</a> for descriptions of our project files.</p>
<h1><a class="anchor" id="sec_files5"></a>
Project Files</h1>
<h2><a class="anchor" id="sub_main5"></a>
Main File</h2>
<p>The main file instantiates our task- and class-files as objects to be run asynchronously. Note the task diagram below for information regarding file communication and run frequency. See <a class="el" href="main_8py.html">main.py</a> for more information. </p><div class="image">
<img src="taskDiagram4.png" alt="" width="600px"/>
</div>
<h2><a class="anchor" id="sub_utask5"></a>
User Task</h2>
<p>The user interface is written as a generator function that prints to a terminal emulator. It is able to read a user's keyboard presses as controller and IMU commands, such as printing the IMU's current Euler angles and angular velocities or accepting user-input controller gain values, over the USB virtual comm port. See <a class="el" href="_u_task5_8py.html">UTask5.py</a> for more information, and the figure below for the User Task's state transition diagram. </p><div class="image">
<img src="term_ui_task_std.png" alt="" width="600px"/>
</div>
<h2><a class="anchor" id="sub_imutask5"></a>
IMU Task</h2>
<p>The IMU task calls methods of the BNO055 driver class, <a class="el" href="_b_n_o055_8py.html">BNO055.py</a>, to read IMU data and prompt user calibration when necessary. See <a class="el" href="_i_m_u_task_8py.html">IMUTask.py</a> for more information and the figure below for the IMU Task's state transition diagram. </p><div class="image">
<img src="imutask_std.png" alt="" width="500px"/>
</div>
<h2><a class="anchor" id="sub_ctask5"></a>
Controller Task</h2>
<p>The controller task communicates controller gain values Kp, Kd, and Ki, angular setpoints, and Euler angle/angular velocity data (read from the IMU device) to our closed-loop driver, <a class="el" href="closedloop5_8py.html">closedloop5.py</a>. This task is also responsible for sending duty cycles to the motor task, which enables motor actuation according to the actuation signal computed in the closed-loop driver. <br  />
 See <a class="el" href="_c_task5_8py.html">CTask5.py</a> for more information and the figure below for the Controller Task's state transition diagram. </p><div class="image">
<img src="term_ctask_std.png" alt="" width="500px"/>
</div>
<h2><a class="anchor" id="sub_mtask5"></a>
Motor Task</h2>
<p>The motor task sends duty cycles, which are determined as the actuation signal of the closed-loop controller, to their respective motors, either Motor 1 or Motor 2. See <a class="el" href="_m_task5_8py.html">MTask5.py</a> for more information and the figure below for the Motor Task's state transition diagram. </p><div class="image">
<img src="MTaskSTD3.png" alt="" width="500px"/>
</div>
<h2><a class="anchor" id="sub_imu5"></a>
BNO055 Driver</h2>
<p>This driver class handles I2C communication with the BNO055 IMU device. Associated methods include reading Euler angle and angular velocity data from the BNO, as well as reading/writing calibration coefficients according to the device's current calibration status. See <a class="el" href="_b_n_o055_8py.html">BNO055.py</a> for more information.</p>
<h2><a class="anchor" id="sub_clc5"></a>
Closed-Loop Control Driver</h2>
<p>The closed-loop driver is a class file that computes actuation signals according to user-defined controller gains Kp, Ki, and Kd, desired setpoint, and, for use with the IMU device, the IMU's Euler angle and angular velocity data. For the self-balancing platform, the angular setpoint defaults to a 0 degree reference angle, such that the controller attempts to reach a level position. The controller is able to perform proportional, integral, and/or derivative control. See <a class="el" href="closedloop5_8py.html">closedloop5.py</a> for more information.</p>
<h2><a class="anchor" id="sub_mot5"></a>
Motor Driver</h2>
<p>The motor driver is a class file that instantiates pin, timer, and timer channel objects for the designated motor's PWM channels, which are configured as inverted PWM channels. The driver also has a method to set motor duty cycles as a pulse width percent, whose value is passed in as the closed-loop controller's actuation signal. See <a class="el" href="motor5_8py.html">motor5.py</a> for more information.</p>
<h2><a class="anchor" id="sub_sha5"></a>
Shares Class</h2>
<p>The shares class file allows variables to be created, read from, and written to multiple files. See <a class="el" href="shares_8py.html">shares.py</a> for more information. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.0
</small></address>
</body>
</html>
